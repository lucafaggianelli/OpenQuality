<div class="page-header">
    <h1><span class="text-primary">#{{defect.id}}</span> {{defect.name}} <span class="label label-primary">{{defect.status}}</span></h1>
</div>

    <div ta-bind ng-model="defect.description"></div>

    <div class="panel panel-default">
        <div class="panel-heading"><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> Info</div>
        <div class="panel-body">
            <p>Detected in version <b>{{defect["detection-version"]}}</b> on <span class="glyphicon glyphicon-calendar" aria-hidden="true"></span
                > <b>{{defect["creation-time"]}}</b> by <span class="glyphicon glyphicon-user" aria-hidden="true"></span
                > <b>{{Users.getName(defect['detected-by'])}}</b>
            </p>
            
            <p>Affetcted terminal <span class="glyphicon glyphicon-phone" aria-hidden="true"></span> <b>{{defect['user-01']}}</b></p>
            
            <p>Severity <span class="glyphicon glyphicon-{{defect.severityIcon}}" aria-hidden="true"></span> <b>{{defect.severity}}</b></p>

            <form class="form-inline" id="defect-status">
                <div class="form-group">
                    <label for="status" class="control-label">Status</label>
                    <select name="status" class="form-control" ng-model="defect.status"
                        ng-options="status for status in fields.status.Values" ng-change="updateField('status')"></select>
                </div>
                    
                <div class="form-group" ng-show="defect.status == 'Fixed'">
                    <label for="user-09" class="control-label">Fixed in build</label>
                    <select name="user-09" class="form-control" ng-model="defect['user-09']"
                        ng-options="val for val in fields['user-09'].Values" ng-change="updateField('user-09')"></select>
                </div>
            </form>

            <form>
                <div class="form-group">
                    <label class="control-label">Assigned to</label>

                    <ui-select class="" ng-model="defect.owner" ng-disabled="disabled"
                            reset-search-input="false" on-select="updateField('owner')">
                        <ui-select-match placeholder="User...">{{$select.selected.fullname}}</ui-select-match>
                        <ui-select-choices repeat="user.id as user in Users.usersArr | filter: $select.search">
                            <div class="media">
                              <div class="media-left">
                                  <img class="media-object" ng-src="{{user.gravatar}}&s=32">
                              </div>
                              <div class="media-body">
                                <h4 class="media-heading" ng-bind-html="(user.fullname | highlight: $select.search) || user.id"></h4>
                                <small>{{user.email}}</small>
                              </div>
                            </div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </form>
        </div>
    </div>

    <!-- Comments -->
    <div class="panel panel-default">
        <div class="panel-heading"><span class="glyphicon glyphicon-comment" aria-hidden="true"></span> <b>Comments</b></div>

        <div class="list-group">
            <a class="list-group-item list-group-item-info" href="" data-toggle="modal" data-target="#new-comment-modal">
                <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add a comment...</a>
            <div class="list-group-item" ng-repeat="comment in defect.comments">
                <p class="list-group-item-heading"><b>{{comment.user}}</b> &middot; <small>{{comment.date}}</small></p>
                <p class="list-group-item-text" ng-bind-html="comment.content"></p>
            </div>
        </div>
    </div>

    <div id="new-comment-modal" class="modal fade">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">New comment</h4>
          </div>
          <div class="modal-body">
            <div text-angular ta-toolbar="{{toolbar}}" ng-model="newComment"></div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-success" data-dismiss="modal" ng-click="addComment()">Add comment</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <!-- Attachments -->
    <div class="panel panel-default">
        <div class="panel-heading"><span class="glyphicon glyphicon-paperclip" aria-hidden="true"></span> <b>Attachments</b></div>

        <div class="list-group">
            <a class="list-group-item list-group-item-info" href="" data-toggle="modal" data-target="#new-attach-modal">
<span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Attach a file...</a>
            <a class="list-group-item" ng-repeat="attachment in defect.attachments" href="{{attachment.url}}" download>
                <p><span class="glyphicon glyphicon-file" aria-hidden="true"></span> {{attachment.name}} ({{getFileSizeString(attachment['file-size'])}} - {{attachment['last-modified']}})</p>
                <p ng-if="attachment.description" ta-bind ng-model="attachment.description"></p>
                <p class="thumbnail" ng-if="isImg(attachment.name)"><img ng-src="{{attachment.url}}"/></p>
            </a>
        </div>
    </div>

    <div id="new-attach-modal" class="modal fade">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">New attachment</h4>
          </div>
          <div class="modal-body">
            <form>
              <input type="text" class="form-control" ng-model="newAttachDesc"></textarea>
              <input type="file" name="file" class="form-control" id="new-attach-file"></textarea>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-success" data-dismiss="modal" ng-click="addAttachment()">Add attachment</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div class="alert alert-danger" ng-show="errorMessage">{{errorMessage}}</div>
